select
M.Participant_First_Name,M.Participant_Last_Name,M.contract_or_family_id, M.Participant_ID_1,M.Participant_ID_2,M.Participant_ID_3,M.Participant_ID_4,
M.member_ssn,M.Medical_Subscriber_ID,M.Participant_Middle_Name,M.Date_of_Birth,
M.Participant_First_Name as  patientInfo_firstNm,
M.Participant_Middle_Name as  patientInfo_middleNm,
M.Participant_Last_Name as  patientInfo_lastNm,
M.Date_of_Birth as patientInfo_dob,
M.Relationship_Code,
case when M.Relationship_Code='1' then 'SCRBR'
                when M.Relationship_Code='2' then 'SPOUS'
                when M.Relationship_Code='3' then 'CHILD'
                when M.Relationship_Code in('4','5','6','7','8') then 'UNKREL'
else NULL end as patientInfo_relationshipCd_code,
case when M.Relationship_Code='1' then 'subscriber'
                when M.Relationship_Code='2' then 'Spouse'
                when M.Relationship_Code='3' then 'Child'
                when M.Relationship_Code in('4','5','6','7','8') then 'Unknown or other relationship'
else NULL end as patientInfo_relationshipCd_name,   
case when M.Relationship_Code='1' then 'subscriber'
                when M.Relationship_Code='2' then 'Spouse'
                when M.Relationship_Code='3' then 'Child'
                when M.Relationship_Code in('4','5','6','7','8') then 'Unknown or other relationship'
else NULL end as patientInfo_relationshipCd_description,   
M.Gender_Code as  patientInfo_gender_code,
M.gender_code,
case when M.gender_code ='M' then 'Male'
     when M.gender_code ='F' then 'Female'
                when M.gender_code ='U' then 'Unknowm'
else NULL end as patientInfo_gender_name,
case when M.gender_code ='M' then 'Male'
     when M.gender_code ='F' then 'Female'
                when M.gender_code ='U' then 'Unknowm'
else NULL end as patientInfo_gender_description,
M.Dependent_ID ,
M.Dependent_ID as  patientInfo_personNbr,
M.Pref_Language_Written,
case when M.Pref_Language_Written in ('NAI', 'ARA', 'ARC', 'HYE', 'W01', 'W02', 'ZHO', 'ENG', 'W04', 'FRA', 'DEU', 'HAW', 'HEB', 'HIN', 'HMN', 'ILO', 'IND', 'GLE', 'ITA', 'JPN', 'KOR', 'LAO', 'W05', 'W08', 'W06', 'FAS', 'POL', 'POR', 'PUS', 'RUS', 'SMO', 'GLA', 'SPA', 'TGL', 'TAH', 'THA', 'TUR', 'VIE', 'W09', 'UND', 'W03') then M.Pref_Language_Written
else 'UND' end as patientInfo_prefLangInd_code,  
case when M.Pref_Language_Written='NAI' then  'American Indian'
when M.Pref_Language_Written='ARA' then  'Arabic'
when M.Pref_Language_Written='ARC' then  'Aramaic'
when M.Pref_Language_Written='HYE' then  'Armenian '
when M.Pref_Language_Written='W01' then  'Cambodian'
when M.Pref_Language_Written='W02' then  'Cantonese'
when M.Pref_Language_Written='ZHO' then  'Chinese'
when M.Pref_Language_Written='ENG' then  'English'
when M.Pref_Language_Written='W04' then  'Farsi'
when M.Pref_Language_Written='FRA' then  'French'
when M.Pref_Language_Written='DEU' then  ' German'
when M.Pref_Language_Written='HAW' then  'Hawaiian'
when M.Pref_Language_Written='HEB' then  'Hebrew'
when M.Pref_Language_Written='HIN' then  'Hindi'
when M.Pref_Language_Written='HMN' then  'Hmong'
when M.Pref_Language_Written='ILO' then  'Ilokano'
when M.Pref_Language_Written='IND' then  'Indonesian'
when M.Pref_Language_Written='GLE' then  'Irish'
when M.Pref_Language_Written='ITA' then  'Italian'
when M.Pref_Language_Written='JPN' then  'Japanese'
when M.Pref_Language_Written='KOR' then  'Korean'
when M.Pref_Language_Written='LAO' then  'Lao '
when M.Pref_Language_Written='W05' then  'Mandarin'
when M.Pref_Language_Written='W08' then  'Mien'
when M.Pref_Language_Written='W06' then  'Nigerian '	
when M.Pref_Language_Written='FAS' then  'Persian'
when M.Pref_Language_Written='POL' then  'Polish'
when M.Pref_Language_Written='POR' then  'Portuguese'
when M.Pref_Language_Written='PUS' then  'Pushto'
when M.Pref_Language_Written='RUS' then  'Russian'
when M.Pref_Language_Written='SMO' then  'Samoan'
when M.Pref_Language_Written='GLA' then  'Scottish'
when M.Pref_Language_Written='SPA' then  'Spanish'
when M.Pref_Language_Written='TGL' then  'Tagalog'
when M.Pref_Language_Written='TAH' then  'Tahitian'
when M.Pref_Language_Written='THA' then  'Thai'
when M.Pref_Language_Written='TUR' then  'Turkish'
when M.Pref_Language_Written='VIE' then  'Vietnamese'
when M.Pref_Language_Written='W09' then  'Other Non-English'
when M.Pref_Language_Written='UND' then  'Undetermined'
when M.Pref_Language_Written='W03' then  'Decline to state'
else 'Undetermined' end as patientInfo_prefLangInd_name,  
case when M.Pref_Language_Written='NAI' then  'American Indian'
when M.Pref_Language_Written='ARA' then  'Arabic'
when M.Pref_Language_Written='ARC' then  'Aramaic'
when M.Pref_Language_Written='HYE' then  'Armenian '
when M.Pref_Language_Written='W01' then  'Cambodian'
when M.Pref_Language_Written='W02' then  'Cantonese'
when M.Pref_Language_Written='ZHO' then  'Chinese'
when M.Pref_Language_Written='ENG' then  'English'
when M.Pref_Language_Written='W04' then  'Farsi'
when M.Pref_Language_Written='FRA' then  'French'
when M.Pref_Language_Written='DEU' then  'German'
when M.Pref_Language_Written='HAW' then  'Hawaiian'
when M.Pref_Language_Written='HEB' then  'Hebrew'
when M.Pref_Language_Written='HIN' then  'Hindi'
when M.Pref_Language_Written='HMN' then  'Hmong'
when M.Pref_Language_Written='ILO' then  'Ilokano'
when M.Pref_Language_Written='IND' then  'Indonesian'
when M.Pref_Language_Written='GLE' then  'Irish'
when M.Pref_Language_Written='ITA' then  'Italian'
when M.Pref_Language_Written='JPN' then  'Japanese'
when M.Pref_Language_Written='KOR' then  'Korean'
when M.Pref_Language_Written='LAO' then  'Lao '
when M.Pref_Language_Written='W05' then  'Mandarin'
when M.Pref_Language_Written='W08' then  'Mien'
when M.Pref_Language_Written='W06' then  'Nigerian '
when M.Pref_Language_Written='FAS' then  'Persian'
when M.Pref_Language_Written='POL' then  'Polish'
when M.Pref_Language_Written='POR' then  'Portuguese'
when M.Pref_Language_Written='PUS' then  'Pushto'
when M.Pref_Language_Written='RUS' then  'Russian'
when M.Pref_Language_Written='SMO' then  'Samoan'
when M.Pref_Language_Written='GLA' then  'Scottish'
when M.Pref_Language_Written='SPA' then  'Spanish'
when M.Pref_Language_Written='TGL' then  'Tagalog'
when M.Pref_Language_Written='TAH' then  'Tahitian'
when M.Pref_Language_Written='THA' then  'Thai'
when M.Pref_Language_Written='TUR' then  'Turkish'
when M.Pref_Language_Written='VIE' then  'Vietnamese'
when M.Pref_Language_Written='W09' then  'Other Non-English'
when M.Pref_Language_Written='UND' then  'Undetermined'
when M.Pref_Language_Written='W03' then  'Decline to state'
else 'Undetermined' end as patientInfo_prefLangInd_description, 
m.Master_Group,  m.src_name,
case when m.Master_Group in ('C00415','174013','200005') and m.src_name='wgs' then 'True'
                when m.Master_Group='003324003' and m.src_name='nsco' then 'True'
                when m.src_name='star' then 'False'
                when m.src_name in ('chips','aces','cs90') then 'False'
else 'False' end  as patientInfo_emplInd,
M.Contract_or_Family_ID ,
M.Contract_or_Family_ID as  planInfo_hcid_contractId,
M.Medical_Subscriber_ID,
M.Medical_Subscriber_ID as  planinfo_subscriberId,
case when M.src_name in ('cr facets','cs90') then M.Medicare_ID else '' end as planInfo_cmsNbr,
M.Participant_Effective_Date,
M.Participant_Effective_Date as  planInfo_effectiveDt,
M.Participant_Expiration_Date,
M.Participant_Expiration_Date as  planInfo_terminationDt,
G.Master_group,
G.Master_group as planInfo_extrnlGroupId, 
M.state, 
M.state as planInfo_stateCd_code, 
case when M.state='AL' then  'Alabama'
when M.state='AK' then  'Alaska'
when M.state='AZ' then  'Arizona'
when M.state='AR' then  'Arkansas'
when M.state='CA' then  'California'
when M.state='CO' then  'Colorado'
when M.state='CT' then  'Connecticut'
when M.state='DE' then  'Delaware'
when M.state='FL' then  'Florida'
when M.state='GA' then  'Georgia'
when M.state='HI' then  'Hawaii'
when M.state='ID' then  'Idaho'
when M.state='IL' then  'Illinois'
when M.state='IN' then  'Indiana'
when M.state='IA' then  'Iowa'
when M.state='KS' then  'Kansas'
when M.state='KY' then  'Kentucky'
when M.state='LA' then  'Louisiana'
when M.state='ME' then  'Maine'
when M.state='MD' then  'Maryland'
when M.state='MA' then  'Massachusetts'
when M.state='MI' then  'Michigan'
when M.state='MN' then  'Minnesota'
when M.state='MS' then  'Mississippi'
when M.state='MO' then  'Missouri'
when M.state='MT' then  'Montana'
when M.state='NE' then  'Nebraska'
when M.state='NV' then  'Nevada'
when M.state='NH' then  'New Hampshire'
when M.state='NJ' then  'New Jersey'
when M.state='NM' then  'New Mexico'
when M.state='NY' then  'New York'
when M.state='NC' then  'North Carolina'
when M.state='ND' then  'North Dakota'
when M.state='OH' then  'Ohio'
when M.state='OK' then  'Oklahoma'
when M.state='OR' then  'Oregon'
when M.state='PA' then  'Pennsylvania'
when M.state='RI' then  'Rhode Island'
when M.state='SC' then  'South Carolina'
when M.state='SD' then  'South Dakota'
when M.state='TN' then  'Tennessee'
when M.state='TX' then  'Texas'
when M.state='UT' then  'Utah'
when M.state='VT' then  'Vermont'
when M.state='VA' then  'Virginia'
when M.state='WA' then  'Washington'
when M.state='WV' then  'West Virginia'
when M.state='WI' then  'Wisconsin'
when M.state='WY' then  'Wyoming'
when M.state='DC' then  'District of Columbia'
when M.state='AS' then  'American Samoa'
when M.state='GU' then  'Guam'
when M.state='MP' then  'Northern Mariana Islands'
when M.state='PR' then  'Puerto Rico'
when M.state='VI' then  'U.S. Virgin Islands'
else NULL end as planInfo_stateCd_name,  
--planInfo_stateCd_description,    --NA  
M.Medicare_ID, 
M.Medicare_ID as  planInfo_medicareid,
   M.Client_Identifier,
concat(M.Client_Identifier,'A') as  planInfo_carrierId,    
G.CMS_Contract_Code,
G.CMS_Contract_Code as  planInfo_contractId, 
M.cms_plan_benefit_package_pbp_id , 
case when M.src_name='aces' then '' else M.cms_plan_benefit_package_pbp_id end as  planInfo_pbpId,
G.Client_Benefit_aka_CVS_Plan_ID ,
G.Client_Benefit_aka_CVS_Plan_ID as  planInfo_bpl,  
G.Client_Plan_Type,
G.Client_Plan_Type as  planInfo_planType,  
M.Client_Group_ID,
M.Client_Group_ID as  planInfo_pharGroupNbr,
case when M.Master_group='IND' then 'INDIV' else M.Master_group end  as planInfo_mastGroupNbr,    
case when M.Master_Group is NULL and  M.src_name='star' then 'STARIN' 
when M.Master_Group='IND' then 'INDIV' else M.Master_Group end as planInfo_groupId, 
G.Group_Name,
 G.Group_Name as  planInfo_groupName,
 G.WLP_Division,
case when TRIM(G.WLP_Division)='NAT' then 'Y' else 'N' end as planInfo_nationalAcctInd,  
'N' as planInfo_rxMigrationSts, 
'2019-07-01' as  planInfo_rxMigrationDt,
G.level1_medical_group_number,  
     G.level1_medical_group_number as planInfo_coverage_subgroupId,   
     NULL as planInfo_coverage_networkId,
	 G. Level3_Benefit_Package_Identifier,
	 G.medical_source_system,
case when M.src_name='nsco' then substr(G.pass_thru_client_defined_data,63,3) 
                 when G.src_name='nsco' then substr(G.pass_thru_client_defined_data,69,3) 
                 when G.src_name='nsco' then substr(G.pass_thru_client_defined_data,142,3) 
                 when G.src_name='nsco' then substr(G.pass_thru_client_defined_data,158,3) 
                 when G.src_name='nsco' then substr(G.pass_thru_client_defined_data,174,3)
     when trim(G.src_name) in('star','fctc','wgs','aces','chips','cs90') then G. Level3_Benefit_Package_Identifier
                else NULL end as planInfo_coverage_product_prodid,  
G.CMS_Contract_Code,				
case when G.src_name='star' then G.CMS_Contract_Code
     --when G.src_name='NSCO' then G.product_identifier  -- not required
                when G.src_name='nsco' then substr(G.pass_thru_client_defined_data,63,3) 
                 when G.src_name='nsco' then substr(G.pass_thru_client_defined_data,69,3) 
                 when G.src_name='nsco' then substr(G.pass_thru_client_defined_data,142,3) 
                 when G.src_name='nsco' then substr(G.pass_thru_client_defined_data,158,3) 
                 when G.src_name='nsco' then substr(G.pass_thru_client_defined_data,174,3) 
                 when trim(G.src_name)='wgs' then substr(M.Miscellaneous_Data,644,15)  -- check in future
--   when G.src_name='WGS' then G.product_identifier  -- not required 
     --when G.src_name='FCTC' then substr(X.Miscellaneous_Data,644,15) 
             when G.src_name='aces' then substr(M.Miscellaneous_Data,644,15)    -- check in future
     else NULL end as planInfo_coverage_product_srcProdCd ,                   --      ** CHIPS, cs90 future scope **
-----------------------------------
                
----------------------    
substr(G.pass_thru_client_defined_data,136,4),   M.src_name,    
case when M.src_name in('nsco','fctc','aces','chips','cs90') then NULL
     when M.src_name='star' then substr(G.pass_thru_client_defined_data,136,4)
                when trim(M.src_name)='wgs' then substr(G.pass_thru_client_defined_data,148,4)
                else NULL end as planInfo_coverage_product_coverageTypeCd_finCompanyCd,     

--. as  PatientCommunication.address.addressTypeCd.name,    -- NA
--. as  PatientCommunication.address.addressTypeCd.description,    --NA

--M.Address_3 as  PatientCommunication_address_addressTypeCd_addressLineThree,  -- NA
-- M.Address_4 as  PatientCommunication_address_addressTypeCd_addressLineFour,  -- NA

G.fully_insured_indicator ,
G.fully_insured_indicator as planInfo_insuredInd,  
M.medical_sequence_number,
M.medical_subscriber_id,
g.medical_source_system,
concat(case when M.medical_sequence_number='' then 'UNK' else M.medical_sequence_number end , '-', case when m.master_group in ('IND','INDIV') then 'INDIV' when  m.master_group='' then 'NA' else m.master_group end, '-', M.medical_subscriber_id, '-', g.medical_source_system) as planInfo_mbrKey,
G.Exchange_Type ,
G.Exchange_Type  as  planInfo_insuredMspInd, 
G.twentyfour_hour_crd_indicator_exigent_pa_status , 
case when M.src_name in ('chips','aces','cs90','cr facets') and G.src_name in ('chips','aces','cs90','cr facets') then '' else
 G.twentyfour_hour_crd_indicator_exigent_pa_status end  as  planInfo_nbbpInd,
case when G.Medical_Source_System='FCTC' then 'FCTS'
                when G.Medical_Source_System='FCTM' then 'MEDISYS'
                when trim(G.Medical_Source_System)='WGS' then 'WGS20'
                when G.Medical_Source_System='CMOR' then 'CMOR'
                when G.Medical_Source_System='NSCO' then 'NASCO'
                when G.Medical_Source_System='ACES' then 'ACES'
                when G.Medical_Source_System='STAR' then 'STAR'
                when G.Medical_Source_System='QCAR' then 'QCARE'
                when G.Medical_Source_System='CS90' then 'CS90'
                when G.Medical_Source_System='CHIP' then 'CHIP'
                when G.Medical_Source_System='AMSY' then 'AMISYS'
                when G.Medical_Source_System='HTLK' then 'HealthLink'
                when G.Medical_Source_System='OAS' then 'OASYS'
                when G.Medical_Source_System='MAC' then 'Machigonne'
                else NULL end as  planInfo_sourceSystemId,  
trim(G.wlp_division),
case when trim(G.wlp_division)='PUB' then 'PUB'
				when trim(G.wlp_division)='NAT' then 'NATIONAL'
				when trim(G.wlp_division)='KEY' then 'KEY'
                when trim(G.wlp_division)='SMG' then 'SM'
                when trim(G.wlp_division)='MJR' then 'LG'
                when trim(G.wlp_division)='SPC' then 'SPC'
                when trim(G.wlp_division)='LOC' then 'LOCAL'
                when trim(G.wlp_division)='IND' then 'IND'
                when trim(G.wlp_division)='STE' then 'STE'
                when trim(G.wlp_division)='SNR' then 'SNR'
                when trim(G.wlp_division)='UNI' then 'UNI'
                when trim(G.wlp_division)='FGS' then 'FGS'
                when trim(G.wlp_division)='CMO' then 'CMO'
                when trim(G.wlp_division)='CNO' then 'CNO'
                when trim(G.wlp_division)='OTH' then 'OTH'
                when trim(G.wlp_division)='PBM' then 'PBM'
                else NULL end as planInfo_productId, 
G.product_service_type,				
case when TRIM(G.product_service_type) in ('FFS', 'HMO', 'HRA', 'HSA', 'HIA', 'POS', 'PPO', 'EPO', 'TRC', 'ANCL') then G.product_service_type
	 else NULL end as  planInfo_ProductType,
	 G.ERISA,
case when G.ERISA='Y' then 'Y'
	 when G.ERISA='N' then 'N' else 'U' end as  planInfo_erisaInd,   
M.wlp_branding,	 
case when M.wlp_branding='GA' then 'BCBSGA'
                when M.wlp_branding='AN' then 'ABCBS'
                when M.wlp_branding='HP' then 'BCBSHPGA'
                when M.wlp_branding='GG' then 'GWLOGO'
                when M.wlp_branding='BS' then 'EBCBS'
                when M.wlp_branding='BC' then 'EBC'
                when M.wlp_branding='VA' then 'BCBSVA'
                when M.wlp_branding='HK' then 'ABCVASSC'
                else NULL end as  planInfo_brandCd_code,    
case when M.wlp_branding='GA' then 'Blue Cross Blue Shield of Georgia'
                when M.wlp_branding='AN' then 'ANTHEM BLUE CROSS AND BLUE SHIELD'
                when M.wlp_branding='HP' then 'BLUE CROSS AND BLUE SHIELD HEALTHCARE PLAN OF GA'
                when M.wlp_branding='GG' then 'GOLDEN WEST DENTAL & VISION'
                when M.wlp_branding='BS' then 'EMPIRE BCBS'
                when M.wlp_branding='BC' then 'EMPIRE BC'
                when M.wlp_branding='VA' then 'Blue Cross Blue Shield of Virginia'
                when M.wlp_branding='HK' then 'ANTHEM HEALTHKEEPERS'
                else NULL end as  planInfo_brandCd_name, 
case when M.wlp_branding='GA' then 'Blue Cross Blue Shield of Georgia'
                when M.wlp_branding='AN' then 'ANTHEM BLUE CROSS AND BLUE SHIELD'
                when M.wlp_branding='HP' then 'BLUE CROSS AND BLUE SHIELD HEALTHCARE PLAN OF GEORGIA'
                when M.wlp_branding='GG' then 'GOLDEN WEST DENTAL & VISION'
                when M.wlp_branding='BS' then 'EMPIRE BLUE CROSS BLUE SHIELD'
                when M.wlp_branding='BC' then 'EMPIRE BLUE CROSS'
                when M.wlp_branding='VA' then 'Blue Cross Blue Shield of Virginia'
                when M.wlp_branding='HK' then 'ANTHEM HEALTHKEEPERS'
                else NULL end as  planInfo_brandCd_description,
substr(G.pass_thru_client_defined_data,136,4),				
case when G.Medical_Source_System='STAR' then substr(G.pass_thru_client_defined_data,136,4)
                when trim(G.Medical_Source_System)='WGS' then substr(G.pass_thru_client_defined_data,148,4) 
                 else '' end as planInfo_cdiInd,     
case when M.src_name='cs90' then substr(M.miscellaneous_data,204,2) else '' end as  planInfo_CS90EmpireShield,     --applicable for cs90 then NULL for other sources ??
case when G.Medical_Source_System='FCTC' then 'FCTS'
                when G.Medical_Source_System='FCTM' then 'MEDISYS'
                when trim(G.Medical_Source_System)='WGS' then 'WGS20'
                when G.Medical_Source_System='CMOR' then 'CMOR'
                when G.Medical_Source_System='NSCO' then 'NASCO'
                when G.Medical_Source_System='ACES' then 'ACES'
                when G.Medical_Source_System='STAR' then 'STAR'
                when G.Medical_Source_System='QCAR' then 'QCARE'
                when G.Medical_Source_System='CS90' then 'CS90'
                when G.Medical_Source_System='CHIP' then 'CHIP'
                when G.Medical_Source_System='AMSY' then 'AMISYS'
                when G.Medical_Source_System='HTLK' then 'HealthLink'
                when G.Medical_Source_System='OAS' then 'OASYS'
                when G.Medical_Source_System='MAC' then 'Machigonne'
                else NULL end as  planInfo_enrollmentSrcSys, 
case when G.Medical_Source_System='STAR' then 'WGS20' 
     when G.Medical_Source_System='NSCO' then 'NASCO' 
	 when G.Medical_Source_System='FCTC' then 'FCTS' 
	 when G.Medical_Source_System='FCTM' then 'MEDISYS' 
	 when trim(G.Medical_Source_System)='WGS' then 'WGS20' 
	 when G.Medical_Source_System='CMOR' then 'Caremore' 
	 when G.Medical_Source_System='ACES' then 'ACES' 
	 when G.Medical_Source_System='QCARE' then 'QCARE' 
	 when G.Medical_Source_System='CHIP' then 'CHIPs' 
	 when G.Medical_Source_System='AMSY' then 'AMISYS' 
	 when G.Medical_Source_System='HTLK' then 'HealthLink' 
	 when G.Medical_Source_System='OAS' then 'OASYS' 
	 when G.Medical_Source_System='MAC' then 'Machigonne' 
else NULL end as  planInfo_claimsSrcSys,
m.address_1,c.address_line_1_txt,m.address_2,c.address_line_2_txt,m.city,c.city_nm,m.state,c.st_cd,m.zip_code,c.zip_cd,
(CASE WHEN c.address_line_1_txt <>'' THEN c.address_line_1_txt ELSE m.address_1 END) AS patientCommunication_address_addressLineOne,
	(CASE WHEN c.address_line_1_txt <>'' AND c.address_line_2_txt <>'' THEN c.address_line_2_txt ELSE m.address_2 END) AS patientCommunication_address_addressLineTwo,
	(CASE WHEN c.city_nm <>'' THEN c.city_nm ELSE m.city END) AS patientCommunication_address_city,
	(CASE WHEN c.st_cd <>'' THEN c.st_cd ELSE m.state END) AS patientCommunication_address_stateCd_code,
	(CASE WHEN c.zip_cd <>'' THEN c.zip_cd ELSE m.zip_code END) AS patientCommunication_address_zipCd, 
	M.Zip_Reserve,
	M.Zip_Reserve as  PatientCommunication_address_addressTypeCd_zipCdExt,
(CASE WHEN c.address_line_1_txt <>''
		   AND c.address_line_2_txt <>''
		   AND c.st_cd <>''
		   AND c.zip_cd <>''
		  THEN 'CNFD'
		  ELSE 'HOME' END) AS  patientCommunication_address_addressTypeCd_code,
'PHONE' as patientCommunication_phoneDetails_phoneTypeCd,
m.phone_number,c.home_tlphn_nbr,c.work_tlphn_nbr,c.mobl_tlphn_nbr,
(CASE WHEN c.home_tlphn_nbr <>'' AND c.work_tlphn_nbr ='' AND c.mobl_tlphn_nbr <>'' THEN c.home_tlphn_nbr
		  WHEN c.home_tlphn_nbr <>'' AND c.work_tlphn_nbr <>'' AND c.mobl_tlphn_nbr ='' THEN c.home_tlphn_nbr
		  WHEN c.home_tlphn_nbr ='' AND c.work_tlphn_nbr <>'' AND c.mobl_tlphn_nbr <>'' THEN c.mobl_tlphn_nbr
		  WHEN c.home_tlphn_nbr <>'' AND c.work_tlphn_nbr <>'' AND c.mobl_tlphn_nbr <>'' THEN c.home_tlphn_nbr
		  WHEN c.home_tlphn_nbr ='' AND c.work_tlphn_nbr <>'' AND c.mobl_tlphn_nbr ='' THEN c.work_tlphn_nbr
		  WHEN c.home_tlphn_nbr <>'' AND c.work_tlphn_nbr ='' AND c.mobl_tlphn_nbr ='' THEN c.home_tlphn_nbr
		  WHEN c.home_tlphn_nbr ='' AND c.work_tlphn_nbr ='' AND c.mobl_tlphn_nbr ='' THEN 'NULL'
		  ELSE m.phone_number END) AS patientCommunication_phoneDetails_phoneNbr,
		  CONCAT(
				(CASE WHEN UPPER(TRIM(m.medical_source_system)) = 'ACES' THEN '822'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'AGPF' THEN '1104'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'AMSY' THEN '868'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'CHIP' THEN '886'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'CMOR' THEN '994'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'CS90' THEN '809'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'FCTC' THEN '823'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'FCTM' THEN '891'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'NSCO' THEN '824'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'QCAR' THEN '867'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'SMPL' THEN '1060'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'STAR' THEN '815'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'WGS'  THEN '808'
						ELSE m.medical_source_system END)
				,'-',
				(CASE WHEN UPPER(TRIM(m.medical_source_system))='STAR' AND (UPPER(TRIM(m.master_group)) IN ('IND', 'INDV')) THEN 'INDIV'
				  WHEN UPPER(TRIM(m.medical_source_system))='STAR' AND TRIM(m.master_group)='' THEN 'NA'
					  ELSE TRIM(m.master_group) END)
				,'-',
				(CASE WHEN UPPER(TRIM(m.medical_source_system))='NSCO' AND LENGTH(TRIM(m.medical_subscriber_id))=9 THEN CONCAT(TRIM(m.medical_subscriber_id),'-',TRIM(m.medical_sequence_number))
WHEN UPPER(TRIM(m.medical_source_system))='NSCO' AND LENGTH(TRIM(m.medical_subscriber_id))=12 AND SUBSTRING(TRIM(m.medical_subscriber_id),1,1) LIKE '%[a-zA-Z]' THEN CONCAT(TRIM(m.medical_subscriber_id),'-',TRIM(m.medical_sequence_number))
WHEN UPPER(TRIM(m.medical_source_system))='NSCO' AND LENGTH(TRIM(m.medical_subscriber_id))=12 AND SUBSTRING(TRIM(m.medical_subscriber_id),1,1) LIKE '%[0-9]' THEN CONCAT(SUBSTRING(TRIM(m.medical_subscriber_id),1,9),'-',TRIM(m.medical_sequence_number),'~',SUBSTRING(TRIM(m.medical_subscriber_id),10,3),'~')
WHEN UPPER(TRIM(m.medical_source_system))='NSCO' AND LENGTH(TRIM(m.medical_subscriber_id))=13 THEN CONCAT(SUBSTRING(TRIM(m.medical_subscriber_id),1,9),'-',TRIM(m.medical_sequence_number),'~',SUBSTRING(TRIM(m.medical_subscriber_id),10,3),'~',SUBSTRING(TRIM(m.medical_subscriber_id),13,1))
WHEN UPPER(TRIM(m.medical_source_system))='STAR' THEN CONCAT(TRIM(m.medical_subscriber_id),'-',CASE WHEN TRIM(m.medical_sequence_number)='' then 'UNK' ELSE TRIM(m.medical_sequence_number) END)
WHEN UPPER(TRIM(m.medical_source_system))in('FCTC','FCTM','CS90','CHIPS','ACES') THEN CONCAT(TRIM(m.medical_subscriber_id),'-', 
CASE WHEN length(TRIM(m.medical_sequence_number))=2 AND SUBSTRING(TRIM(m.medical_sequence_number),1,1)=0 THEN SUBSTRING(TRIM(m.medical_sequence_number),2,1) 
ELSE TRIM(m.medical_sequence_number) END)
ELSE CONCAT(TRIM(m.medical_subscriber_id),'-',TRIM(m.medical_sequence_number)) END)
		) as mcid
		  
    from 
	(
	select * from(
	select *,
    row_number() over (partition by client_identifier, client_group_id, contract_or_family_id, dependent_id, participant_first_name, date_of_birth, gender_code, relationship_code,participant_effective_date order by load_ingstn_id desc)rn2
	from ts_pbmpdrzph_gbd_r000_wh.vw_rxmbrshp_mbr)mb
	where mb.rn2=1
	)M
	inner join ts_pbmpdrzph_gbd_r000_wh.vw_rxmbrshp_grp G
    on --m.src_name=g.src_name and
    G.client_identifier=M.client_identifier and 
    G.Client_Group_Number=M.client_group_id  
    left outer join 
    (
    select a.frst_nm,a.last_nm,a.brth_dt,a.gndr_cd,a.hcid,a.rn,a.contract,
    a.home_tlphn_nbr,a.mobl_tlphn_nbr,a.work_tlphn_nbr,a.address_line_1_txt,a.address_line_2_txt,a.city_nm,a.st_cd,a.zip_cd
    from(
    select frst_nm,last_nm,brth_dt,gndr_cd,hcid,contract,
    home_tlphn_nbr,mobl_tlphn_nbr,work_tlphn_nbr,address_line_1_txt,address_line_2_txt,city_nm,st_cd,zip_cd,
    row_number() over (partition by frst_nm,last_nm,brth_dt,gndr_cd,hcid order by load_ingstn_id desc) as rn
    from ts_pbmpdrzph_gbd_r000_wh.cirs_lookup)a
    where a.rn=1
    )c
    on c.frst_nm=m.Participant_First_Name
    and c.last_nm=m.Participant_last_Name
    and c.brth_dt=m.Date_of_Birth
    and c.gndr_cd=m.Gender_Code
    and m.Contract_or_Family_ID=(case when c.hcid is not null then c.hcid else c.contract end)
 
	INNER JOIN 
	(
	select mc.src_key,mc.src_sor_cd from
	(
	select src_key,src_sor_cd,
	row_number() over(partition by src_key order by load_log_key desc) as rn1
	from ts_pbmpdrzph_gbd_r000_wh.vw_edi_edw_mdm_ppltn_xwalk
	where xwalk_trmntn_dt >=xwalk_efctv_dt
	)mc
	where mc.rn1=1
	)mc
	ON 
	--(mc.src_key=CONCAT(TRIM(m.pbm_sor_cd),'-',TRIM(m.master_group_modified),'-',TRIM(M.medical_subscriber_id),'-',TRIM(M.medical_seq_number_modified)))
	 --(mc.src_key=CONCAT(TRIM(m.pbm_sor_cd),'-',TRIM(m.master_group),'-',substr(TRIM(M.medical_subscriber_id),9),'-',TRIM(M.medical_sequence_number)))
    
    (mc.src_key=
		CONCAT(
				(CASE WHEN UPPER(TRIM(m.medical_source_system)) = 'ACES' THEN '822'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'AGPF' THEN '1104'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'AMSY' THEN '868'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'CHIP' THEN '886'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'CMOR' THEN '994'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'CS90' THEN '809'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'FCTC' THEN '823'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'FCTM' THEN '891'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'NSCO' THEN '824'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'QCAR' THEN '867'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'SMPL' THEN '1060'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'STAR' THEN '815'
						WHEN UPPER(TRIM(m.medical_source_system)) = 'WGS'  THEN '808'
						ELSE m.medical_source_system END)
				,'-',
				(CASE WHEN UPPER(TRIM(m.medical_source_system))='STAR' AND (UPPER(TRIM(m.master_group)) IN ('IND', 'INDV')) THEN 'INDIV'
				  WHEN UPPER(TRIM(m.medical_source_system))='STAR' AND TRIM(m.master_group)='' THEN 'NA'
					  ELSE TRIM(m.master_group) END)
				,'-',
				(CASE WHEN UPPER(TRIM(m.medical_source_system))='NSCO' AND LENGTH(TRIM(m.medical_subscriber_id))=9 THEN CONCAT(TRIM(m.medical_subscriber_id),'-',TRIM(m.medical_sequence_number))
WHEN UPPER(TRIM(m.medical_source_system))='NSCO' AND LENGTH(TRIM(m.medical_subscriber_id))=12 AND SUBSTRING(TRIM(m.medical_subscriber_id),1,1) LIKE '[a-zA-Z]%' THEN CONCAT(TRIM(m.medical_subscriber_id),'-',TRIM(m.medical_sequence_number))
WHEN UPPER(TRIM(m.medical_source_system))='NSCO' AND LENGTH(TRIM(m.medical_subscriber_id))=12 AND SUBSTRING(TRIM(m.medical_subscriber_id),1,1) LIKE '[0-9]%' THEN CONCAT(SUBSTRING(TRIM(m.medical_subscriber_id),1,9),'-',TRIM(m.medical_sequence_number),'~',SUBSTRING(TRIM(m.medical_subscriber_id),10,3),'~')
WHEN UPPER(TRIM(m.medical_source_system))='NSCO' AND LENGTH(TRIM(m.medical_subscriber_id))=13 THEN CONCAT(SUBSTRING(TRIM(m.medical_subscriber_id),1,9),'-',TRIM(m.medical_sequence_number),'~',SUBSTRING(TRIM(m.medical_subscriber_id),10,3),'~',SUBSTRING(TRIM(m.medical_subscriber_id),13,1))
WHEN UPPER(TRIM(m.medical_source_system))='STAR' THEN CONCAT(TRIM(m.medical_subscriber_id),'-',CASE WHEN TRIM(m.medical_sequence_number)='' then 'UNK' ELSE TRIM(m.medical_sequence_number) END)
WHEN UPPER(TRIM(m.medical_source_system))in('FCTC','FCTM','CS90','CHIPS','ACES') THEN CONCAT(TRIM(m.medical_subscriber_id),'-', 
CASE WHEN length(TRIM(m.medical_sequence_number))=2 AND SUBSTRING(TRIM(m.medical_sequence_number),1,1)=0 THEN SUBSTRING(TRIM(m.medical_sequence_number),2,1) 
ELSE TRIM(m.medical_sequence_number) END)
ELSE CONCAT(TRIM(m.medical_subscriber_id),'-',TRIM(m.medical_sequence_number)) END)

		))
    
    where G.current_effective_date <=M.Participant_Effective_Date
    and G.group_expiration_date>= M.Participant_Expiration_Date          
    and trim(m.src_name)='nsco'  
    and trim(G.src_name)='nsco' 
    and trim(G.medical_source_system) in ('NSCO')
	and trim(M.medical_source_system) in ('NSCO')
    --and mc.src_sor_cd='808'
    and m.pbm_sor_cd='824'   limit 200
    
    --set mapred.job.queue.name = root.ldr_yarn;
	
	
	
	g.cms_contract_code=Rx.CMS Contract ID
g.master_group=Rx.master_group
g.client_plan_type=Rx.plan_type
g.medical_source_system=Rx.platform_code
g.level1_medical_group_number=Rx.medical_group_number
g.client_group_number=Rx.Pharmacy_Group_Number
-----------------------------------------------
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.patientInfo.relationshipCd")
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.patientInfo.genderCd")
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.hcid.prefix")
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.stateCd.code",
{'memberDetailValue.planInfo.stateCd.code' : {$nin: ['AL' ,'AK' ,'AZ' ,'AR' ,'CA' ,'CO' ,'CT' ,'DE' ,'FL' ,'GA' ,'HI' ,'ID' ,
        'IL' ,'IN' ,'IA' ,'KS' ,'KY' ,'LA' ,'ME' ,'MD' ,'MA' ,'MI' ,'MN' ,'MS' ,'MO' ,'MT' ,'NE' ,'NV' ,'NH' ,'NJ' ,'NM' ,'NY' ,
        'NC' ,'ND' ,'OH' ,'OK' ,'OR' ,'PA' ,'RI' ,'SC' ,'SD' ,'TN' ,'TX' ,'UT' ,'VT' ,'VA' ,'WA' ,'WV' ,'WI' ,'WY' ,'DC' ,'AS' ,
        'GU' ,'MP' ,'PR' ,'VI']}}) 
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.pbpId",
{'memberDetailValue.planInfo.sourceSystemId':"ACES"}
)
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.insuredInd")
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.claimsSrcSys")
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.nbbpInd",
{'memberDetailValue.planInfo.sourceSystemId' : {$in: ['CHIPS','ACES','CS90','FCTS']}})
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.sourceSystemId")
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.productId",
{'memberDetailValue.planInfo.productId' : {$nin: ['NATIONAL' ,'KEY' ,'PUB' ,'SM' ,'LG' ,'SPC' ,'LOCAL' ,'IND' ,'STE' ,
        'SNR' ,'UNI' ,'FGS' ,'CMO' ,'CNO' ,'OTH' ,'PBM']}})
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.productType",
{'memberDetailValue.planInfo.productType' : {$nin: ['FFS', 'HMO', 'HRA', 'HSA', 'HIA', 'POS', 'PPO', 'EPO', 'TRC', 'ANC', 'ANCL']}})
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.erisaInd")
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.enrollmentSrcSys")
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.planInfo.cdiInd",
{'memberDetailValue.planInfo.sourceSystemId':{$nin:['STAR','WGS20']}} )		
db.getCollection('memberDetail_FEB04').distinct ("memberDetailValue.patientInfo.prefLangInd.code",
{'memberDetailValue.patientInfo.prefLangInd.code' : {$nin: ['NAI', 'ARA', 'ARC', 'HYE', 'W01', 'W02', 'ZHO', 'ENG', 'W04', 'FRA', 'DEU',
    'HAW', 'HEB', 'HIN', 'HMN', 'ILO', 'IND', 'GLE', 'ITA', 'JPN', 'KOR', 'LAO', 'W05', 'W08', 'W06', 'FAS', 'POL', 'POR', 'PUS',
    'RUS', 'SMO', 'GLA', 'SPA', 'TGL', 'TAH', 'THA', 'TUR', 'VIE', 'W09', 'UND', 'W03']}})
